<%# This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
Copyright (c) Jade Systems Inc. 2013, 2014
%>
<%= validation_messages @completed_routine %>

    <%= content_tag_for(:div, @completed_routine, class: "content") do %>
      <%= form_for(@completed_routine) do |crf| %>
        <%= crf.hidden_field :name %>
        <%= crf.hidden_field :routine_id %>
        <%= crf.hidden_field :person_id %>
        <table>
          <thead>
            <tr>
              <th>Expectation</th><th>Yes</th><th>No</th><th>N/A</th><th>Comments</th>
            </tr>
          </thead>
          <tbody>
            <%= crf.fields_for :completed_expectations do |cef| %>
              <tr>
                <td>
                  <%= cef.label(:description, cef.object.description) %>
                  <%= cef.hidden_field :description %>
                </td>
                <td style="text-align: center;"><%= cef.radio_button :observation, "Y" %></td>
                <td style="text-align: center;"><%= cef.radio_button :observation, "N"  %></td>
                <td style="text-align: center;"><%= cef.radio_button :observation, "N/A"  %></td>
                <td><%= cef.text_field(:comment, placeholder: "Comment", class: "grow_child_to_parent") %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
        <p>
          <%= crf.label(:category_name, 'Category: ') %>
          <%= crf.text_field(:category_name, 
            placeholder: "Category", 
            id: "completed_routine_category_name", 
            data: { autocomplete_source: RoutineCategory.order(:name).map(&:name) }) %>
        </p>
        <p><%= crf.label 'Comment: ' %><%= crf.text_field(:comment, placeholder: "Comment", class: "grow_child_to_parent") %></p>
        <p>
          <%= crf.label(:routine_done_at, class: "ui-hidden-accessible") %>
          <% @completed_routine.routine_done_at ||= Time.current %>
          <%= crf.text_field :routine_done_at, 
            value: @completed_routine.routine_done_at.to_s(:datetime_local),
            placeholder: "Routine Date/Time", 
            type: "datetime-local",
            class: "datetimepicker" %>
       </p>
        <p>
          <%= crf.label :recorded_by, "Recorded by: " %>
          <%= crf.text_field :recorded_by, value: crf.object.recorded_by.name, disabled: true %>
          <%= crf.label :updated_by, "Updated by: " %>
          <%= crf.text_field :updated_by, value: current_user.name, disabled: true %>
        </p>
        <!-- The following button trick doesn't work for <= IE8 -->
        <%= link_to '<button type="button">Cancel</button>'.html_safe, :back %>
        <%= crf.submit 'Save' %>
      <% end %>
    <% end %>

