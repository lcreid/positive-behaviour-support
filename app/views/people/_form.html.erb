<%# This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
Copyright (c) Jade Systems Inc. 2013, 2014
%>
<div id="person_edit" class="container">
  <div class="content">
    <%= form_for @person do |pf| %>
      <%= pf.hidden_field :creator_id %>
      <p><%= pf.label :name, 'Name: ' %><%= pf.text_field :name %></p>
      <div class="even_row">
        <div class="left" style="width:48%;">
          <p>
            <%= pf.label :short_name, 'Short Name: ' %><%= pf.text_field :short_name %>
          </p>
        </div>
        <div class="right" style="width:48%;">
          <p>
            Choose a short name that identifies the person to you and the rest
            of the team, but won't necessarily identify the person to anyone else.
            This is so you don't have to worry about people identifying the person
            by looking over your shoulder.
          </p>
        </div>
        <div class="clear"></div>
      </div>
    
      <div>
        <h2>Team</h2>
        <%# The team are my users who are connected to the patient. %>
        <%# You may be able to see team members without being able to change them. %>
        <ul class="ul_no_decorations">
          <%= pf.collection_check_boxes(:users, 
            (current_user.users + @person.users).uniq, 
            :id, 
            :name, 
            checked: @person.users.map(&:id)) do |cb| %> <%# FIXME Not just primary_identity %>
            <li>
              <%= cb.check_box(hidden: current_user == cb.object) %>
              <%= cb.label(hidden: current_user == cb.object) %>
            </li>
          <% end %>
        </ul>
      </div>

      <p>
        <%= link_to '<button type="button">Cancel</button>'.html_safe, :back %>
        <%= pf.submit 'Save' %>
      </p>
    <% end %>
  </div>
</div>
